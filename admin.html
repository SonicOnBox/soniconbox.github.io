<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SonicOnBox - Pro Admin Panel v2</title>
    <style>
        #loginPanel { 
            font-family: 'Segoe UI', sans-serif; background: #1a1a1a; color: white; 
            text-align: center; height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .login-box { background: #2c3e50; padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 1px solid #3498db; }
        .login-box input { padding: 12px; border-radius: 5px; border: none; margin: 10px 0; width: 250px; font-size: 1rem; }
        .login-box button { padding: 12px 30px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }

        #adminContent { display: none; font-family: 'Segoe UI', sans-serif; background: #1a1a1a; color: white; padding: 20px; }
        .container { max-width: 1100px; margin: 0 auto; background: #2c3e50; padding: 30px; border-radius: 15px; }
        h1 { color: #f1c40f; text-align: center; }
        h2 { color: #e67e22; border-bottom: 2px solid #e67e22; padding-bottom: 10px; margin-top: 30px; }
        
        .generator-container, .editor-container { background: #34495e; padding: 25px; border-radius: 10px; margin-top: 20px; }
        label { font-weight: bold; display: block; margin-top: 15px; color: #ecf0f1; }
        input, select, textarea { width: 100%; padding: 10px; margin-top: 5px; border-radius: 5px; border: none; box-sizing: border-box; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        button { flex: 1; padding: 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-gen { background: #27ae60; color: white; }
        .btn-load { background: #3498db; color: white; }
        .btn-download { background: #e74c3c; color: white; display: none; }
        
        /* Keres≈ë √©s lista st√≠lus */
        .search-box { margin-bottom: 15px; padding: 10px; border-radius: 5px; border: none; width: 100%; background: #ecf0f1; }
        .mod-list { max-height: 300px; overflow-y: auto; background: #1a1a1a; border-radius: 5px; padding: 10px; }
        .mod-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #333; }
        .mod-item:hover { background: #222; }
        .delete-btn { background: #c0392b; color: white; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 0.8rem; }
        .delete-btn:hover { background: #e74c3c; }

        pre { background: #1a1a1a; color: #2ecc71; padding: 15px; border-radius: 5px; overflow-x: auto; white-space: pre-wrap; font-size: 0.85rem; max-height: 300px; border: 1px solid #27ae60; }
    </style>
</head>
<body>

    <div id="loginPanel">
        <div class="login-box">
            <h1>Admin Access</h1>
            <input type="password" id="passInput" placeholder="Password...">
            <br>
            <button onclick="checkPass()">Unlock</button>
            <p id="errorMsg" style="color: #e74c3c; display: none; margin-top: 10px;">Incorrect Password!</p>
        </div>
    </div>

    <div id="adminContent">
        <div class="container">
            <h1>üìä SonicOnBox Pro Admin v2</h1>

            <h2>üìÇ Manage Existing Mods</h2>
            <div class="editor-container">
                <button class="btn-load" onclick="loadAndParse()">1. Load Current Mods from downloads.html</button>
                <div id="managementArea" style="display:none; margin-top:20px;">
                    <input type="text" class="search-box" id="modSearch" onkeyup="filterModList()" placeholder="üîç Search mod by name...">
                    <div class="mod-list" id="modListDisplay"></div>
                </div>
            </div>

            <h2>üöÄ Add New Mod</h2>
            <div class="generator-container">
                <label>Mod Name:</label>
                <input type="text" id="genName" placeholder="e.g. Steampunk Metal Sonic">
                <label>Game:</label>
                <select id="genGame">
                    <option value="generations">Sonic Generations</option>
                    <option value="shadow_gen">Shadow Generations</option>
                    <option value="unleashed">Sonic Unleashed</option>
                    <option value="racing">Sonic Racing Crossworlds</option>
                    <option value="minecraft">Minecraft Maps</option>
                </select>
                <label>Description:</label>
                <textarea id="genDesc" rows="2"></textarea>
                <label>Redirect ID & Link:</label>
                <input type="text" id="genRedirectId" placeholder="ID">
                <input type="text" id="genLink" placeholder="URL">
                <label>Images:</label>
                <input type="file" id="imagePicker" multiple accept="image/*">

                <div class="btn-group">
                    <button class="btn-gen" onclick="finalizeFile()">üõ†Ô∏è Apply Changes & Assemble</button>
                    <button id="downloadBtn" class="btn-download" onclick="downloadFile()">üíæ Download Updated downloads.html</button>
                </div>
                <pre id="outputCode" style="display:none; margin-top:20px;"></pre>
            </div>
        </div>
    </div>

    <script>
        let fullHtmlContent = "";
        let modsArray = [];

        function checkPass() {
            if (document.getElementById('passInput').value === "n$i#Sr") {
                document.getElementById('loginPanel').style.display = "none";
                document.getElementById('adminContent').style.display = "block";
            } else { document.getElementById('errorMsg').style.display = "block"; }
        }

        // 1. F√°jl beolvas√°sa √©s modok sz√©tszed√©se
        async function loadAndParse() {
            try {
                const response = await fetch('downloads.html?t=' + Date.now());
                fullHtmlContent = await response.text();
                
                const parser = new DOMParser();
                const doc = parser.parseFromString(fullHtmlContent, 'text/html');
                const modCards = doc.querySelectorAll('.mod-card');
                
                modsArray = [];
                modCards.forEach((card, index) => {
                    modsArray.push({
                        id: index,
                        name: card.querySelector('.mod-title').innerText,
                        html: card.outerHTML
                    });
                });

                displayMods();
                document.getElementById('managementArea').style.display = "block";
                alert("Mods loaded successfully!");
            } catch (e) { alert("Error loading downloads.html"); }
        }

        // 2. Modok list√°z√°sa
        function displayMods() {
            const listDiv = document.getElementById('modListDisplay');
            listDiv.innerHTML = "";
            modsArray.forEach(mod => {
                listDiv.innerHTML += `
                    <div class="mod-item" data-name="${mod.name.toLowerCase()}">
                        <span>${mod.name}</span>
                        <button class="delete-btn" onclick="deleteMod(${mod.id})">Delete</button>
                    </div>`;
            });
        }

        // 3. Keres√©s funkci√≥
        function filterModList() {
            const query = document.getElementById('modSearch').value.toLowerCase();
            document.querySelectorAll('.mod-item').forEach(item => {
                item.style.display = item.getAttribute('data-name').includes(query) ? "flex" : "none";
            });
        }

        // 4. T√∂rl√©s a mem√≥ri√°b√≥l
        function deleteMod(id) {
            if(confirm("Are you sure you want to delete this mod from the file?")) {
                modsArray = modsArray.filter(m => m.id !== id);
                displayMods();
            }
        }

        // 5. √öj mod k√°rtya √©s a teljes f√°jl √∂sszerak√°sa
        function finalizeFile() {
            if (!fullHtmlContent) { alert("Please load the file first!"); return; }

            // √ñsszerakjuk a megmaradt modokat
            const modsHtml = modsArray.map(m => m.html).join('\n            ');
            
            // √öj mod gener√°l√°sa (ha van kit√∂ltve n√©v)
            let newCardHtml = "";
            const newName = document.getElementById('genName').value;
            if (newName) {
                const game = document.getElementById('genGame').value;
                const desc = document.getElementById('genDesc').value;
                const rid = document.getElementById('genRedirectId').value;
                const link = encodeURIComponent(document.getElementById('genLink').value);
                const files = document.getElementById('imagePicker').files;
                let imgHtml = "";
                for(let f of files) { imgHtml += `<img src="images/${f.name}" onclick="openLightbox(this)">\n`; }
                
                newCardHtml = `
            <div class="mod-card" data-game="${game}">
                <div class="mod-header"><span class="mod-title">${newName}</span><span class="game-tag">${game.toUpperCase()}</span></div>
                <div class="mod-content">
                    <div class="mod-info"><p>${desc}</p><a href="redirect.html?id=${rid}&link=${link}" class="download-btn">Download</a></div>
                    <div class="preview-grid gallery">${imgHtml}</div>
                </div>
            </div>`;
            }

            // A modContainer tartalm√°nak cser√©je
            const startTag = '<div class="content-area" id="modContainer">';
            const endTag = '</div>\n    </div>\n\n    <footer>'; // Ez a downloads.html szerkezet√©t≈ël f√ºgg
            
            const head = fullHtmlContent.split(startTag)[0] + startTag + '\n            <p id="noModsText" style="display:none; text-align:center; color:#777;">No mods found for this game yet.</p>\n            ';
            const foot = '\n        ' + fullHtmlContent.split('</div>\n    </div>')[1]; // A v√©g√©t megtartjuk

            updatedHtml = head + modsHtml + newCardHtml + '</div>\n    </div>' + foot;

            document.getElementById('outputCode').textContent = updatedHtml;
            document.getElementById('outputCode').style.display = "block";
            document.getElementById('downloadBtn').style.display = "block";
            alert("Changes applied! You can now download the updated file.");
        }

        function downloadFile() {
            const blob = new Blob([document.getElementById('outputCode').textContent], { type: 'text/html' });
            const a = document.createElement('a');
            a.href = window.URL.createObjectURL(blob);
            a.download = 'downloads.html';
            a.click();
        }
    </script>
</body>
</html>
