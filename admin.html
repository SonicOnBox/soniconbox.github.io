<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SonicOnBox - Pro Admin Panel</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #1a1a1a; color: white; padding: 20px; }
        .container { max-width: 1100px; margin: 0 auto; background: #2c3e50; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h1 { color: #f1c40f; text-align: center; }
        h2 { color: #e67e22; border-bottom: 2px solid #e67e22; padding-bottom: 10px; margin-top: 40px; }
        
        .generator-container { background: #34495e; padding: 25px; border-radius: 10px; margin-top: 20px; }
        label { font-weight: bold; display: block; margin-top: 15px; color: #ecf0f1; }
        input, select, textarea { width: 100%; padding: 10px; margin-top: 5px; border-radius: 5px; border: none; box-sizing: border-box; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        button { flex: 1; padding: 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-gen { background: #27ae60; color: white; }
        .btn-download { background: #e74c3c; color: white; display: none; }
        button:hover { opacity: 0.8; transform: translateY(-2px); }

        pre { background: #1a1a1a; color: #2ecc71; padding: 15px; border-radius: 5px; overflow-x: auto; white-space: pre-wrap; font-size: 0.85rem; max-height: 400px; border: 1px solid #27ae60; }
        .step-info { background: #2980b9; padding: 10px; border-radius: 5px; margin-bottom: 20px; font-size: 0.9rem; }
    </style>
</head>
<body>

    <div class="container">
        <h1>üìä SonicOnBox Pro Admin</h1>

        <div class="step-info">
            <strong>Haszn√°lat:</strong> V√°laszd ki a j√°t√©kot, t√∂ltsd ki az adatokat, majd kattints a k√≥d gener√°l√°s√°ra. 
            A rendszer automatikusan hozz√°adja a modot a megfelel≈ë szekci√≥hoz.
        </div>

        <h2>üöÄ √öj Mod Hozz√°ad√°sa</h2>
        <div class="generator-container">
            <label>Mod Neve (Pl: Steampunk Metal Sonic in Crossworlds):</label>
            <input type="text" id="genName" placeholder="A mod teljes neve...">

            <label>Verzi√≥:</label>
            <input type="text" id="genVersion" value="v1.0">

            <label>Melyik j√°t√©khoz tartozik?</label>
            <select id="genGame">
                <optgroup label="Hedge Engine Games">
                    <option value="generations">Sonic Generations</option>
                    <option value="shadow_gen">Shadow Generations</option>
                    <option value="unleashed">Sonic Unleashed</option>
                    <option value="lost_world">Sonic Lost World</option>
                    <option value="forces">Sonic Forces</option>
                    <option value="frontiers">Sonic Frontiers</option>
                    <option value="superstars">Sonic Superstars</option>
                    <option value="colors">Sonic Colors Ultimate</option>
                    <option value="sadx">Sonic Adventure DX</option>
                    <option value="sa2">Sonic Adventure 2</option>
                    <option value="06">Sonic '06</option>
                    <option value="racing">Sonic Racing Crossworlds</option>
                </optgroup>
                <optgroup label="Retro Engine Games">
                    <option value="mania">Sonic Mania Plus</option>
                    <option value="origins">Sonic Origins</option>
                </optgroup>
                <optgroup label="Other Games">
                    <option value="minecraft">Minecraft Maps</option>
                </optgroup>
            </select>

            <label>Le√≠r√°s:</label>
            <textarea id="genDesc" rows="3" placeholder="Itt √≠rd le a mod r√©szleteit..."></textarea>

            <label>Redirect ID:</label>
            <input type="text" id="genRedirectId" placeholder="Pl: steampunk_metal_racing">

            <label>Let√∂lt√©si Link:</label>
            <input type="text" id="genLink" placeholder="Google Drive vagy Mediafire link">

            <label>K√©pek kiv√°laszt√°sa:</label>
            <input type="file" id="imagePicker" multiple accept="image/*">

            <div class="btn-group">
                <button class="btn-gen" onclick="processFullFile()">üõ†Ô∏è K√≥d √ñssze√°ll√≠t√°sa</button>
                <a id="downloadAnchor" style="display:none"></a>
                <button id="downloadBtn" class="btn-download" onclick="downloadUpdatedFile()">üíæ K√©sz downloads.html Let√∂lt√©se</button>
            </div>

            <h3 id="previewTitle" style="display:none; margin-top:30px;">El≈ën√©zet (Az √∫j f√°jl tartalma):</h3>
            <pre id="outputCode" style="display:none;"></pre>
        </div>
    </div>

    <script>
        let updatedFullContent = "";

        // Seg√©df√ºggv√©ny a sz√©p j√°t√©knevekhez a s√°rga tag-hez
        function getGameDisplayName(val) {
            const names = {
                'generations': 'Sonic Generations',
                'shadow_gen': 'Shadow Generations',
                'unleashed': 'Sonic Unleashed',
                'lost_world': 'Sonic Lost World',
                'forces': 'Sonic Forces',
                'frontiers': 'Sonic Frontiers',
                'superstars': 'Sonic Superstars',
                'colors': 'Sonic Colors Ultimate',
                'sadx': 'Sonic Adventure DX',
                'sa2': 'Sonic Adventure 2',
                '06': "Sonic '06",
                'racing': 'Sonic Racing Crossworlds',
                'mania': 'Sonic Mania Plus',
                'origins': 'Sonic Origins',
                'minecraft': 'Minecraft Maps'
            };
            return names[val] || val.toUpperCase();
        }

        async function processFullFile() {
            try {
                const response = await fetch('downloads.html?t=' + Date.now());
                if (!response.ok) throw new Error();
                let currentHtml = await response.text();

                const newModCard = createModCard();
                const containerId = 'id="modContainer"';
                const containerIndex = currentHtml.indexOf(containerId);
                
                if (containerIndex === -1) {
                    alert("Hiba: Nem tal√°lom a modContainer-t a downloads.html f√°jlban!");
                    return;
                }

                const searchPart = currentHtml.substring(containerIndex);
                const closingDivIndex = searchPart.indexOf('</div>'); 
                const actualContainerEnd = searchPart.indexOf('</div>', closingDivIndex + 1); 
                
                const insertPosition = containerIndex + actualContainerEnd;
                updatedFullContent = currentHtml.slice(0, insertPosition) + newModCard + "\n" + currentHtml.slice(insertPosition);

                document.getElementById('outputCode').textContent = updatedFullContent;
                document.getElementById('outputCode').style.display = "block";
                document.getElementById('previewTitle').style.display = "block";
                document.getElementById('downloadBtn').style.display = "block";
                
                alert("Siker! A lista friss√≠tve lett minden j√°t√©kkal. T√∂ltsd le a k√©sz f√°jlt!");

            } catch (error) {
                alert("Hiba: A downloads.html nem tal√°lhat√≥ az admin.html mellett!");
            }
        }

        function createModCard() {
            const name = document.getElementById('genName').value || "√öj Mod";
            const version = document.getElementById('genVersion').value || "v1.0";
            const gameValue = document.getElementById('genGame').value;
            const gameDisplay = getGameDisplayName(gameValue);
            const desc = document.getElementById('genDesc').value || "";
            const redirectId = document.getElementById('genRedirectId').value || "id";
            const link = encodeURIComponent(document.getElementById('genLink').value || "");
            const files = document.getElementById('imagePicker').files;

            let imagesHtml = "";
            for (let file of files) {
                imagesHtml += `                            <img src="images/${file.name}" onclick="openLightbox(this)" onerror="this.src='https://via.placeholder.com/150'">\n`;
            }

            return `
            <div class="mod-card" data-game="${gameValue}">
                <div class="mod-header">
                    <span class="mod-title">${name}</span>
                    <span class="mod-version">${version}</span>
                    <span class="game-tag">${gameDisplay}</span>
                </div>
                <div class="mod-content">
                    <div class="mod-info">
                        <p><strong>Description:</strong></p>
                        <p>${desc}</p>
                        <a href="redirect.html?id=${redirectId}&link=${link}" target="_blank" class="download-btn">Download</a>
                    </div>
                    <div class="mod-previews">
                        <p><strong>Previews:</strong></p>
                        <div class="preview-grid gallery">
${imagesHtml.trimEnd()}
                        </div>
                    </div>
                </div>
            </div>
            `;
        }

        function downloadUpdatedFile() {
            if (!updatedFullContent) return;
            const blob = new Blob([updatedFullContent], { type: 'text/html' });
            const url = window.URL.createObjectURL(blob);
            const a = document.getElementById('downloadAnchor');
            a.href = url;
            a.download = 'downloads.html';
            a.click();
            window.URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
