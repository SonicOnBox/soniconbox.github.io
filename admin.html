<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SonicOnBox - Ultimate Local Admin</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #1a1a1a; color: white; padding: 20px; line-height: 1.6; }
        .container { max-width: 1100px; margin: 0 auto; background: #2c3e50; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h1 { color: #f1c40f; text-align: center; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 2px; }
        .status-bar { text-align: center; color: #bdc3c7; font-size: 0.9rem; margin-bottom: 20px; border-bottom: 1px solid #34495e; padding-bottom: 10px; }
        h2 { color: #e67e22; border-bottom: 2px solid #e67e22; padding-bottom: 10px; margin-top: 30px; display: flex; align-items: center; gap: 10px; }
        
        .box { background: #34495e; padding: 25px; border-radius: 10px; margin-top: 20px; border: 1px solid #455a64; }
        label { font-weight: bold; display: block; margin-top: 15px; color: #ecf0f1; }
        input, select, textarea { width: 100%; padding: 12px; margin-top: 5px; border-radius: 5px; border: none; box-sizing: border-box; background: #ecf0f1; color: #2c3e50; font-size: 1rem; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        button { flex: 1; padding: 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.3s; font-size: 1rem; text-transform: uppercase; }
        .btn-gen { background: #27ae60; color: white; }
        .btn-load { background: #3498db; color: white; }
        .btn-download { background: #e74c3c; color: white; display: none; }
        .btn-script { background: #8e44ad; color: white; }
        button:hover { opacity: 0.9; transform: translateY(-2px); filter: brightness(1.1); }
        
        /* File upload st√≠lus */
        input[type="file"] { background: #2c3e50; color: white; border: 1px dashed #95a5a6; }

        .search-box { margin-bottom: 15px; padding: 12px; border-radius: 5px; border: none; width: 100%; background: #ecf0f1; }
        .mod-list { max-height: 300px; overflow-y: auto; background: #1a1a1a; border-radius: 5px; padding: 10px; border: 1px solid #34495e; }
        .mod-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #333; }
        .delete-btn { background: #c0392b; color: white; padding: 6px 12px; border-radius: 4px; cursor: pointer; border: none; font-size: 0.8rem; }
        
        pre { background: #000; color: #2ecc71; padding: 15px; border-radius: 5px; overflow-x: auto; white-space: pre-wrap; font-size: 0.8rem; max-height: 250px; border: 1px solid #27ae60; margin-top: 20px; }
        .target-selector { background: #f1c40f; color: #2c3e50; padding: 10px; border-radius: 5px; font-weight: bold; margin-bottom: 20px; text-align: center; }
    </style>
</head>
<body>

    <div class="container">
        <h1>üìä SonicOnBox Local Admin</h1>
        <div class="status-bar">OFFLINE SZERKESZT≈ê ‚Äî V√°lassz f√°jlt a g√©pedr≈ël!</div>

        <h2>1. F√°jl Kiv√°laszt√°sa</h2>
        <div class="box">
            <label>Melyik f√°jlt szerkesztj√ºk? (downloads.html vagy commission.html)</label>
            <input type="file" id="fileInput" accept=".html" onchange="loadFileLocal()">
            <div id="fileInfo" style="margin-top: 10px; color: #2ecc71; font-weight: bold; display: none;">F√°jl bet√∂ltve! J√∂het a szerkeszt√©s.</div>
            
            <div id="managementArea" style="display:none; margin-top:20px;">
                <label>Megl√©v≈ë elemek t√∂rl√©se:</label>
                <input type="text" class="search-box" id="modSearch" onkeyup="filterModList()" placeholder="üîç Keres√©s n√©v alapj√°n...">
                <div class="mod-list" id="modListDisplay"></div>
            </div>
        </div>

        <h2>2. √öj Tartalom Hozz√°ad√°sa</h2>
        <div class="box">
            <label>N√©v/C√≠m:</label>
            <input type="text" id="genName" placeholder="Pl: Steampunk Metal Sonic">
            
            <label>J√°t√©k Kiv√°laszt√°sa:</label>
            <select id="genGame">
                <optgroup label="Hedge Engine Games">
                    <option value="generations">Sonic Generations</option>
                    <option value="shadow_gen">Shadow Generations</option>
                    <option value="frontiers">Sonic Frontiers</option>
                    <option value="superstars">Sonic Superstars</option>
                    <option value="unleashed">Sonic Unleashed</option>
                    <option value="colors">Sonic Colors Ultimate</option>
                    <option value="forces">Sonic Forces</option>
                    <option value="lost_world">Sonic Lost World</option>
                    <option value="sadx">Sonic Adventure DX</option>
                    <option value="sa2">Sonic Adventure 2</option>
                    <option value="06">Sonic '06</option>
                    <option value="racing">Sonic Racing Crossworlds</option>
                </optgroup>
                <optgroup label="Retro Engine Games">
                    <option value="mania">Sonic Mania Plus</option>
                    <option value="origins">Sonic Origins</option>
                    <option value="cd">Sonic CD</option>
                </optgroup>
                <optgroup label="Other Games">
                    <option value="minecraft">Minecraft Maps</option>
                    <option value="rumble">Sonic Rumble</option>
                    <option value="dash">Sonic Dash / Forces Speed Battle</option>
                </optgroup>
            </select>

            <label>Le√≠r√°s:</label>
            <textarea id="genDesc" rows="3" placeholder="Ide j√∂n a r√©szletes le√≠r√°s..."></textarea>
            
            <label>Verzi√≥ (Csak commission.html-n√©l):</label>
            <input type="text" id="genVersion" value="v1.0" placeholder="Pl: v1.0">

            <label>Redirect ID (Egyedi azonos√≠t√≥):</label>
            <input type="text" id="genRedirectId" placeholder="Pl: steampunk_metal_01">
            
            <label>Let√∂lt√©si/K√ºls≈ë Link:</label>
            <input type="text" id="genLink" placeholder="Google Drive, Mediafire vagy Discord link">
            
            <label>K√©pek (Csak a f√°jlnevek gener√°l√°shoz):</label>
            <input type="file" id="imagePicker" multiple accept="image/*">
            <small style="color:#bdc3c7;">Megjegyz√©s: Ez csak a HTML k√≥dot gener√°lja, a k√©peket neked kell bem√°solni az images/ mapp√°ba!</small>

            <div class="btn-group">
                <button class="btn-gen" onclick="finalizeFile()">üõ†Ô∏è Hozz√°ad√°s √©s Ment√©s El≈ëk√©sz√≠t√©se</button>
                <button id="downloadBtn" class="btn-download" onclick="downloadFile()">üíæ M√≥dos√≠tott HTML Let√∂lt√©se</button>
            </div>
            
            <pre id="outputCode" style="display:none;"></pre>
        </div>

        <h2>3. K√©p √Åtnevez≈ë Seg√©d (Batch Script)</h2>
        <div class="box">
            <p>Mivel a b√∂ng√©sz≈ë nem tudja k√∂zvetlen√ºl √°tnevezni a f√°jlokat a g√©peden, itt gener√°lhatsz egy kis programot (.bat), amit ha lefuttatsz a k√©pek mapp√°j√°ban, megcsin√°lja helyetted.</p>
            
            <label>K√≠v√°nt f√°jln√©v alap (Prefix):</label>
            <input type="text" id="renamerBase" placeholder="Pl: sonic1_soniconbox">
            
            <label>Kiterjeszt√©s:</label>
            <select id="renamerExt">
                <option value=".png">.png</option>
                <option value=".jpg">.jpg</option>
                <option value=".jpeg">.jpeg</option>
            </select>

            <button class="btn-script" style="margin-top:15px;" onclick="downloadRenamerScript()">üìú √Åtnevez≈ë Script Let√∂lt√©se (.bat)</button>
            <p style="font-size: 0.8rem; color: #f1c40f; margin-top: 10px;">Haszn√°lat: T√∂ltsd le, m√°sold be abba a mapp√°ba ahol a k√©pek vannak, √©s kattints r√° k√©tszer.</p>
        </div>
    </div>

    <script>
        let fullHtmlContent = "";
        let modsArray = [];
        let loadedFileName = "";
        let isCommissionFile = false;

        function loadFileLocal() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            if (!file) return;

            loadedFileName = file.name;
            // Detekt√°ljuk, hogy ez a commission.html-e
            isCommissionFile = loadedFileName.includes("commission");

            const reader = new FileReader();
            reader.onload = function(e) {
                fullHtmlContent = e.target.result;
                document.getElementById('fileInfo').innerText = "‚úÖ " + loadedFileName + " bet√∂ltve! (" + (isCommissionFile ? "Commission M√≥d" : "Mod M√≥d") + ")";
                document.getElementById('fileInfo').style.display = "block";
                
                parseCurrentContent();
            };
            reader.readAsText(file);
        }

        function parseCurrentContent() {
            const parser = new DOMParser();
            const doc = parser.parseFromString(fullHtmlContent, 'text/html');
            
            // Ha commission.html, akkor work-card, ha downloads, akkor mod-card
            const selector = isCommissionFile ? '.work-card' : '.mod-card';
            const cards = doc.querySelectorAll(selector);
            
            modsArray = [];
            cards.forEach((card, index) => {
                // Commission f√°jln√°l hagyjuk b√©k√©n a statikus k√°rty√°kat (info, prices, oc-characters)
                if(isCommissionFile && (card.id === 'info' || card.id === 'prices' || card.id === 'oc-characters')) return;

                const titleSelector = isCommissionFile ? '.work-title' : '.mod-title';
                const titleEl = card.querySelector(titleSelector);
                const title = titleEl ? titleEl.innerText : "N√©vtelen elem";
                
                modsArray.push({
                    id: index,
                    name: title,
                    originalHtml: card.outerHTML
                });
            });

            displayMods();
            document.getElementById('managementArea').style.display = "block";
        }

        function displayMods() {
            const listDiv = document.getElementById('modListDisplay');
            listDiv.innerHTML = "";
            if(modsArray.length === 0) listDiv.innerHTML = "<p style='color:#777;'>Nincsenek szerkeszthet≈ë dinamikus elemek, vagy m√©g nem adt√°l hozz√°.</p>";
            
            modsArray.forEach(mod => {
                listDiv.innerHTML += `
                    <div class="mod-item" data-name="${mod.name.toLowerCase()}">
                        <span><strong>${mod.name}</strong></span>
                        <button class="delete-btn" onclick="deleteMod(${mod.id})">T√∂rl√©s a list√°b√≥l</button>
                    </div>`;
            });
        }

        function filterModList() {
            const query = document.getElementById('modSearch').value.toLowerCase();
            document.querySelectorAll('.mod-item').forEach(item => {
                item.style.display = item.getAttribute('data-name').includes(query) ? "flex" : "none";
            });
        }

        function deleteMod(id) {
            if(confirm("Ez t√∂r√∂lni fogja ezt a bejegyz√©st a gener√°lt f√°jlb√≥l. Biztos?")) {
                // Megjel√∂lj√ºk t√∂r√∂ltnek a HTML tartalomban majd a ment√©sn√©l
                modsArray = modsArray.filter(m => m.id !== id);
                
                // Mivel a fullHtmlContent-b≈ël kell kivenni, ez bonyolultabb.
                // Egyszer≈±s√≠t√©s: A finalizeFile √∫jra√©p√≠ti az eg√©szet? 
                // A legegyszer≈±bb, ha string replace-t haszn√°lunk a kimenetn√©l, 
                // de a jelenlegi logik√°val csak kivessz√ºk a list√°b√≥l, 
                // √©s a finalize-n√°l √∫jra kellene √©p√≠teni a DOM-ot.
                // Jelenleg ez a t√∂rl√©s gomb csak a list√°b√≥l veszi ki vizu√°lisan, 
                // a profi DOM manipul√°ci√≥hoz a finalizeFile f√ºggv√©nyt b≈ëv√≠tj√ºk.
                alert("A t√∂rl√©s √©rv√©nyes√≠t√©s√©hez nyomd meg a 'M√≥dos√≠tott HTML Let√∂lt√©se' gombot a v√©g√©n (el≈ëtte √©p√≠tsd √∂ssze).");
                displayMods();
            }
        }

        function finalizeFile() {
            if (!fullHtmlContent) { alert("El≈ëbb tall√≥zz be egy f√°jlt!"); return; }
            
            const newName = document.getElementById('genName').value;
            const game = document.getElementById('genGame').value;
            const desc = document.getElementById('genDesc').value;
            const rid = document.getElementById('genRedirectId').value;
            const link = encodeURIComponent(document.getElementById('genLink').value);
            const version = document.getElementById('genVersion').value;
            
            // K√©pek HTML gener√°l√°sa
            const files = document.getElementById('imagePicker').files;
            let imgHtml = "";
            for(let f of files) { 
                imgHtml += `<img src="images/${f.name}" onclick="openLightbox(this)" onerror="this.src='https://via.placeholder.com/150'">\n                            `; 
            }

            // √öj k√°rtya HTML gener√°l√°sa a f√°jlt√≠pust√≥l f√ºgg≈ëen
            let newCardHtml = "";
            if (newName) {
                if (isCommissionFile) {
                    // Commission.html strukt√∫ra
                    newCardHtml = `
            <div class="work-card" data-game="${game}" style="display: flex;"> <div class="work-header">
                    <span class="work-title">${newName}</span>
                    <span class="work-version">${version}</span>
                    <span class="game-tag">${game.toUpperCase()}</span>
                </div>
                <div class="work-content">
                    <div class="work-info">
                        <p><strong>Description:</strong></p>
                        <p>${desc}</p>
                        <a href="redirect.html?id=${rid}&link=${link}" target="_blank" class="download-btn">Download</a>
                    </div>
                    <div class="work-previews">
                        <p><strong>Previews:</strong></p>
                        <div class="preview-grid gallery">
                            ${imgHtml}
                        </div>
                    </div>
                </div>
            </div>`;
                } else {
                    // Downloads.html strukt√∫ra
                    newCardHtml = `
            <div class="mod-card" data-game="${game}">
                <div class="mod-header"><span class="mod-title">${newName}</span><span class="game-tag">${game.toUpperCase()}</span></div>
                <div class="mod-content">
                    <div class="mod-info"><p><strong>Description:</strong></p><p>${desc}</p><a href="redirect.html?id=${rid}&link=${link}" target="_blank" class="download-btn">Link</a></div>
                    <div class="mod-previews"><div class="preview-grid gallery">${imgHtml}</div></div>
                </div>
            </div>`;
                }
            }

            // DOM manipul√°ci√≥ a besz√∫r√°shoz
            const parser = new DOMParser();
            const doc = parser.parseFromString(fullHtmlContent, 'text/html');

            if (isCommissionFile) {
                // Commission: A "prices" ID-j≈± div ut√°n sz√∫rjuk be, hogy fel√ºl legyen a list√°ban
                const pricesDiv = doc.getElementById('prices');
                if (pricesDiv) {
                    // Csin√°lunk egy ideiglenes t√°rol√≥t, hogy HTML stringb≈ël Node legyen
                    const temp = document.createElement('div');
                    temp.innerHTML = newCardHtml;
                    // Besz√∫r√°s a prices div ut√°n (insertAdjacentElement nem mindig m≈±k√∂dik parserben, insertBefore a nextSibling el√©)
                    pricesDiv.parentNode.insertBefore(temp.firstElementChild, pricesDiv.nextSibling);
                } else {
                    // Ha nincs prices div, a mainContent elej√©re
                    const mainContent = doc.getElementById('mainContent');
                    const temp = document.createElement('div');
                    temp.innerHTML = newCardHtml;
                    mainContent.insertBefore(temp.firstElementChild, mainContent.firstChild);
                }
            } else {
                // Downloads: A modContainer elej√©re
                const container = doc.getElementById('modContainer');
                if (container) {
                    const temp = document.createElement('div');
                    temp.innerHTML = newCardHtml;
                    // Prepend: besz√∫r√°s az elej√©re
                    container.insertBefore(temp.firstElementChild, container.firstChild);
                }
            }

            // Friss√≠tj√ºk a kimeneti k√≥dot
            const finalString = "<!DOCTYPE html>\n" + doc.documentElement.outerHTML;
            document.getElementById('outputCode').textContent = finalString;
            document.getElementById('outputCode').style.display = "block";
            document.getElementById('downloadBtn').style.display = "block";
            document.getElementById('downloadBtn').innerText = "üíæ " + loadedFileName + " Ment√©se";
            
            alert("A k√≥d elk√©sz√ºlt! Az √∫j elem a lista elej√©re ker√ºlt.");
        }

        function downloadFile() {
            const content = document.getElementById('outputCode').textContent;
            if(!content) return;
            const blob = new Blob([content], { type: 'text/html' });
            const a = document.createElement('a');
            a.href = window.URL.createObjectURL(blob);
            a.download = loadedFileName;
            a.click();
        }

        function downloadRenamerScript() {
            const baseName = document.getElementById('renamerBase').value || "image";
            const ext = document.getElementById('renamerExt').value;
            
            // Batch script tartalom
            // Ez a script v√©gigmegy az aktu√°lis mapp√°n, √©s √°tnevez minden f√°jlt a megadott kiterjeszt√©ssel
            const scriptContent = `@echo off
setlocal enabledelayedexpansion
set "count=1"
echo K√©pek √°tnevez√©se folyamatban...
echo Alap n√©v: ${baseName}
echo Kiterjeszt√©s: ${ext}

for %%f in (*${ext}) do (
    if not "%%f"=="renamer.bat" (
        ren "%%f" "${baseName}!count!${ext}"
        set /a count+=1
    )
)
echo K√©sz! √ñsszesen !count! f√°jl feldolgozva.
pause`;

            const blob = new Blob([scriptContent], { type: 'text/plain' });
            const a = document.createElement('a');
            a.href = window.URL.createObjectURL(blob);
            a.download = "kep_atnevezo.bat";
            a.click();
        }
    </script>
</body>
</html>